<!DOCTYPE html>
<html>
<head>
    <title>Test Modal Flow</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .test-button { 
            background: #4CAF50; 
            color: white; 
            padding: 15px 32px; 
            text-align: center; 
            text-decoration: none; 
            display: inline-block; 
            font-size: 16px; 
            margin: 4px 2px; 
            cursor: pointer; 
            border: none; 
            border-radius: 5px; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .console-output { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 3px; 
            font-family: monospace; 
            white-space: pre-line; 
        }
    </style>
</head>
<body>
    <h1>🧪 Test Modal Flow</h1>
    
    <div class="test-section">
        <h2>1. Test Modal System</h2>
        <button class="test-button" onclick="testModalSystem()">Test Modal API</button>
        <div id="modalTest" class="console-output"></div>
    </div>

    <div class="test-section">
        <h2>2. Simulate Image Comparison</h2>
        <button class="test-button" onclick="simulateImageComparison()">Show Image Comparison</button>
        <div id="imageTest" class="console-output"></div>
    </div>

    <div class="test-section">
        <h2>3. Simulate Progress Modal</h2>
        <button class="test-button" onclick="simulateProgressModal()">Open Progress Modal</button>
        <div id="progressTest" class="console-output"></div>
    </div>

    <div class="test-section">
        <h2>4. Simulate Video Completion</h2>
        <button class="test-button" onclick="simulateVideoCompletion()">Complete Video</button>
        <div id="videoTest" class="console-output"></div>
    </div>

    <div class="test-section">
        <h2>5. Copy Video to Simulate Detection</h2>
        <button class="test-button" onclick="copyVideoToFinalFolder()">Copy Test Video</button>
        <div id="copyTest" class="console-output"></div>
    </div>

    <!-- Include the main dashboard elements for testing -->
    <div id="imageComparison" style="display: none;">
        <img id="originalImage" />
        <img id="transformedImage" />
    </div>

    <script>
        function log(elementId, message) {
            document.getElementById(elementId).textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        function testModalSystem() {
            log('modalTest', 'Checking window.Modals...');
            if (window.Modals) {
                log('modalTest', '✅ window.Modals is available');
                log('modalTest', 'Available methods: ' + Object.keys(window.Modals).join(', '));
            } else {
                log('modalTest', '❌ window.Modals is NOT available');
                log('modalTest', 'Need to load the modal scripts first');
            }
        }

        function simulateImageComparison() {
            log('imageTest', 'Setting up test images...');
            
            const originalImg = document.getElementById('originalImage');
            const transformedImg = document.getElementById('transformedImage');
            const comparison = document.getElementById('imageComparison');
            
            if (originalImg && transformedImg && comparison) {
                originalImg.src = '/final_videos/demo1.mp4'; // Using video as placeholder
                transformedImg.src = '/final_videos/demo1.mp4';
                comparison.style.display = 'block';
                
                log('imageTest', '✅ Image comparison setup complete');
                log('imageTest', 'Now testing modal update...');
                
                if (window.Modals && window.Modals.forceUpdateImageComparison) {
                    window.Modals.forceUpdateImageComparison();
                    log('imageTest', '✅ Modal image comparison updated');
                } else {
                    log('imageTest', '❌ Modal system not available');
                }
            } else {
                log('imageTest', '❌ Image elements not found');
            }
        }

        function simulateProgressModal() {
            log('progressTest', 'Opening progress modal...');
            
            if (window.Modals && window.Modals.showProgressDialog) {
                window.Modals.showProgressDialog();
                log('progressTest', '✅ Progress modal opened');
                
                // Add some test logs
                setTimeout(() => {
                    if (window.Modals.addProgressLog) {
                        window.Modals.addProgressLog('🎵 Starting automatic subtitle generation...');
                        log('progressTest', '✅ Added test log 1');
                    }
                }, 1000);
                
                setTimeout(() => {
                    if (window.Modals.addProgressLog) {
                        window.Modals.addProgressLog('🎤 Transcribing audio with Whisper...');
                        log('progressTest', '✅ Added test log 2');
                    }
                }, 2000);
            } else {
                log('progressTest', '❌ Modal system not available');
            }
        }

        function simulateVideoCompletion() {
            log('videoTest', 'Simulating video completion...');
            
            if (window.Modals && window.Modals.showProgressVideo) {
                const testVideoData = {
                    videoPath: '/final_videos/demo1.mp4',
                    videoName: 'demo1.mp4',
                    videoSize: 7933987,
                    size: '7.56 MB'
                };
                
                window.Modals.showProgressVideo(testVideoData);
                log('videoTest', '✅ Video completion simulated');
                
                setTimeout(() => {
                    if (window.Modals.finalizeProgressVideo) {
                        window.Modals.finalizeProgressVideo();
                        log('videoTest', '✅ Video finalized');
                    }
                }, 3000);
            } else {
                log('videoTest', '❌ Modal system not available');
            }
        }

        async function copyVideoToFinalFolder() {
            log('copyTest', 'Attempting to copy video...');
            log('copyTest', 'Note: This would normally trigger automatic detection');
            log('copyTest', 'In real system, when a new video appears in final_videos/');
            log('copyTest', 'the SSE would send a video_completion event');
            log('copyTest', 'For now, manually trigger with simulateVideoCompletion()');
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testModalSystem, 500);
        });
    </script>

    <!-- Include modal scripts if available -->
    <script src="/frontend/dashboard.modals.js" onerror="console.log('Modal script not found')"></script>
    <script src="/frontend/dashboard-optimized.js" onerror="console.log('Dashboard script not found')"></script>
</body>
</html>